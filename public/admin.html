<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Admin - Peta Rawan Narkoba</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <link rel="stylesheet" href="/styles.css" />
</head>
<body>
  <nav class="top-nav admin-nav">
    <div class="nav-container">
      <div class="nav-logo-section">
        <img class="nav-logo" src="/logo-bnn.png" id="logoImg" alt="Logo BNN" />
        <div class="nav-text">
          <h1 class="nav-title">âš™ï¸ Admin Dashboard</h1>
          <p class="nav-subtitle">Kelola Peta Rawan Narkoba - Tanjungpinang</p>
        </div>
      </div>
    </div>
  </nav>

  <section class="admin-panel">
    <div class="admin-grid">
      <!-- Logo Section -->
      <div class="admin-card">
        <h2 class="card-title">ğŸ›ï¸ Update Logo BNN</h2>
        <form id="logoForm" class="form-group card-content">
          <div style="display:flex; gap:20px; align-items:center; margin-bottom:20px;">
            <div style="flex-shrink:0;">
              <label style="font-weight:600; margin-bottom:10px; display:block; font-size:0.9rem;">Preview:</label>
              <img id="logoPreview" src="/logo-bnn.svg" alt="Logo BNN" style="width:70px; height:70px; border-radius:6px; border:2px solid #ddd; background:white; padding:4px;" />
            </div>
            <div style="flex:1;">
              <div id="logoDragDrop" class="logo-drag-drop">
                <input type="file" id="logoInput" name="logo" accept="image/svg+xml,image/png,image/jpeg" style="display:none;" />
                <div style="text-align:center; padding:20px;">
                  <p style="margin:0 0 8px 0; font-weight:600; color:#333;">ğŸ“ Drop logo di sini atau klik</p>
                  <p style="margin:0; font-size:0.85rem; color:#666;">SVG, PNG, atau JPG (max 2MB)</p>
                </div>
              </div>
              <button type="submit" class="btn btn-danger" style="margin-top:10px; width:100%;">ğŸ–¼ï¸ Upload Logo</button>
            </div>
          </div>
        </form>
      </div>

      <!-- Banner Section -->
      <div class="admin-card">
        <h2 class="card-title">ğŸ“¸ Update Banner</h2>
        <form id="bannerForm" class="form-group card-content">
          <div class="file-input-wrapper">
            <input type="file" id="bannerInput" name="banner" accept="image/*" />
            <label for="bannerInput" class="file-label">Pilih Gambar Banner</label>
          </div>
          <div class="form-field">
            <label>Caption:</label>
            <input type="text" name="caption" placeholder="Masukkan caption untuk banner..." />
          </div>
          <button type="submit" class="btn btn-danger">ğŸ“¤ Upload Banner</button>
        </form>
      </div>

      <!-- Map Section -->
      <div class="admin-card full-width">
        <h2 class="card-title">ğŸ“ Pilih Lokasi pada Peta</h2>
        <p class="card-subtitle">Klik pada peta untuk memilih koordinat titik pengguna</p>
        <div id="adminMap" class="admin-map-large"></div>
      </div>

      <!-- Point Form Section -->
      <div class="admin-card">
        <h2 class="card-title">â• Tambah Titik Pengguna</h2>
        <form id="pointForm" class="form-group card-content">
          <div style="display:flex; gap:10px; margin-bottom:15px; width:100%;">
            <button type="button" id="gpsBtn" class="btn btn-primary" style="flex:1;">ğŸ“ Ambil Koordinat dari GPS</button>
            <div id="gpsStatus" style="flex:1; padding:10px; background:#f0f0f0; border-radius:6px; display:none; align-content:center; font-size:0.9rem; color:#666;">
              <span id="gpsStatusText">Mengakses GPS...</span>
            </div>
          </div>
          <div class="form-row">
            <div class="form-field">
              <label>Latitude:</label>
              <input type="number" step="any" name="lat" placeholder="cth: 0.9167" required />
            </div>
            <div class="form-field">
              <label>Longitude:</label>
              <input type="number" step="any" name="lng" placeholder="cth: 104.4510" required />
            </div>
          </div>
          <div class="form-field">
            <label>Catatan:</label>
            <input type="text" name="note" placeholder="Deskripsi singkat lokasi..." />
          </div>
          <div class="form-field">
            <label>Kelurahan (wajib):</label>
            <select name="kelurahan" id="kelurahanSelect" required>
              <option value="">-- Pilih kelurahan --</option>
            </select>
          </div>
          <button type="submit" class="btn btn-danger">â• Tambah Titik</button>
        </form>
      </div>

      <!-- Points List Section -->
      <div class="admin-card full-width">
        <h2 class="card-title">ğŸ“‹ Daftar Titik yang Ditambahkan</h2>
        <div class="points-list-wrapper">
          <ul id="pointsList" class="points-list"></ul>
          <div id="emptyState" class="empty-state">
            <p>Belum ada titik yang ditambahkan. Mulai dengan klik peta atau isi form di atas.</p>
          </div>
        </div>
      </div>
    </div>
  </section>

  <script>
    // Force reload logo with cache-busting timestamp
    document.getElementById('logoImg').src = '/logo-bnn.png?t=' + Date.now();
  </script>

  <footer class="footer admin-footer">
    <div class="footer-container">
      <p>&copy; 2025 Peta Rawan Narkoba - Admin Panel</p>
      <p style="font-size:0.8rem;color:#888;">Akses terbatas untuk administrator</p>
    </div>
  </footer>

  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script src="/admin.js"></script>
</body>
</html>
